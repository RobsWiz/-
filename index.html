<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FF14 5v5 ジョブ抽選</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin: 24px; background:#0b1020; color:#fff; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .topbar { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08); color:#fff; cursor:pointer; }
    button:hover { background:rgba(255,255,255,.14); }
    .tag { display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.2); }
    .ok { border-color:#2e7d32; color:#7CFF9B; }
    .warn { border-color:#b71c1c; color:#ff8a8a; }
    .muted { color:rgba(255,255,255,.7); font-size:13px; }
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .card { border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:14px; background:rgba(255,255,255,.05); }
    ul { margin:10px 0 0; padding-left:20px; }
    li { margin:6px 0; }
    code { background:rgba(255,255,255,.12); padding:2px 6px; border-radius:6px; }
    @media (max-width: 820px){ .grid2 { grid-template-columns:1fr; } }

    /* 文字とアイコンを大きめに */
    .jobRow{ display:flex; align-items:center; gap:10px; }
    .jobIcon{ width:28px; height:28px; object-fit:contain; flex:0 0 28px; }
    .jobRow span{ font-size:16px; font-weight:600; }
  </style>
</head>
<body>
  <h1>5対5 ジョブランダム抽選（チーム内重複なし / 近接差±1以内）</h1>

  <div class="topbar">
    <button id="btn">ランダム抽選</button>
    <button id="btnCopy">結果をコピー</button>
    <span id="status" class="tag muted">未抽選</span>
    <span class="muted">ルール: チーム内重複NG / |近接A-近接B| ≤ 1</span>
  </div>

  <div class="grid2">
    <div class="card">
      <div><strong>チームA</strong> <span id="countA" class="muted"></span></div>
      <ul id="teamA"></ul>
    </div>
    <div class="card">
      <div><strong>チームB</strong> <span id="countB" class="muted"></span></div>
      <ul id="teamB"></ul>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <div><strong>抽選ログ</strong></div>
    <div id="log" class="muted" style="margin-top:8px;">ここに試行回数などが出ます</div>
    <div class="muted" style="margin-top:8px;">
      ※条件が厳しい時は自動で引き直します（最大 <code>5000</code> 回試行）。
    </div>
  </div>

<script>
  const JOBS = [
    // 近接
    { name: "ナイト", role: "近接" },
    { name: "戦士", role: "近接" },
    { name: "ガンブレイカー", role: "近接" },
    { name: "暗黒騎士", role: "近接" },
    { name: "竜騎士", role: "近接" },
    { name: "侍", role: "近接" },
    { name: "忍者", role: "近接" },
    { name: "リーパー", role: "近接" },
    { name: "ヴァイパー", role: "近接" },
    { name: "モンク", role: "近接" },

    // 遠隔
    { name: "踊り子", role: "遠隔" },
    { name: "吟遊詩人", role: "遠隔" },
    { name: "機工士", role: "遠隔" },
    { name: "召喚士", role: "遠隔" },
    { name: "赤魔道士", role: "遠隔" },
    { name: "黒魔道士", role: "遠隔" },
    { name: "ピクトマンサー", role: "遠隔" },
    { name: "白魔道士", role: "遠隔" },
    { name: "学者", role: "遠隔" },
    { name: "占星術師", role: "遠隔" },
    { name: "賢者", role: "遠隔" },
  ];

  const JOB_ICON = {
    "ナイト": "Paladin.png",
    "戦士": "Warrior.png",
    "ガンブレイカー": "Gunbreaker.png",
    "暗黒騎士": "DarkKnight.png",
    "竜騎士": "Dragoon.png",
    "侍": "Samurai.png",
    "忍者": "Ninja.png",
    "リーパー": "Reaper.png",
    "ヴァイパー": "Viper.png",
    "モンク": "Monk.png",
    "吟遊詩人": "Bard.png",
    "機工士": "Machinist.png",
    "踊り子": "Dancer.png",
    "黒魔道士": "BlackMage.png",
    "召喚士": "Summoner.png",
    "赤魔道士": "RedMage.png",
    "ピクトマンサー": "Pictomancer.png",
    "白魔道士": "WhiteMage.png",
    "学者": "Scholar.png",
    "占星術師": "Astrologian.png",
    "賢者": "Sage.png",
  };

  function getJobIconPath(jobName){
    const file = JOB_ICON[jobName];
    return file ? `./icons/${file}` : null;
  }

  function randInt(max) { return Math.floor(Math.random() * max); }

  function pickUniqueJobs(k) {
    const pool = JOBS.slice();
    const out = [];
    for (let i = 0; i < k; i++) {
      const idx = randInt(pool.length);
      out.push(pool[idx]);
      pool.splice(idx, 1);
    }
    return out;
  }

  function countRole(team, role) {
    return team.reduce((acc, j) => acc + (j.role === role ? 1 : 0), 0);
  }

  function formatJob(job) {
    return `${job.name}（${job.role}）`;
  }

  function generateMatch(maxTries = 5000) {
    for (let t = 1; t <= maxTries; t++) {
      const teamA = pickUniqueJobs(5);
      const teamB = pickUniqueJobs(5); // Aと被ってOK

      const meleeA = countRole(teamA, "近接");
      const meleeB = countRole(teamB, "近接");
      if (Math.abs(meleeA - meleeB) <= 1) {
        return { teamA, teamB, tries: t, meleeA, meleeB };
      }
    }
    return null;
  }

  const elA = document.getElementById("teamA");
  const elB = document.getElementById("teamB");
  const elCountA = document.getElementById("countA");
  const elCountB = document.getElementById("countB");
  const elStatus = document.getElementById("status");
  const elLog = document.getElementById("log");
  const btn = document.getElementById("btn");
  const btnCopy = document.getElementById("btnCopy");

  // 安全なDOM生成版（壊れにくい）
  function renderTeam(el, team) {
    el.innerHTML = "";
    team.forEach(j => {
      const li = document.createElement("li");

      const row = document.createElement("div");
      row.className = "jobRow";

      const icon = getJobIconPath(j.name);
      if (icon) {
        const img = document.createElement("img");
        img.className = "jobIcon";
        img.src = icon;
        img.alt = j.name;
        row.appendChild(img);
      }

      const span = document.createElement("span");
      span.textContent = formatJob(j);
      row.appendChild(span);

      li.appendChild(row);
      el.appendChild(li);
    });
  }

  function setStatus(text, ok) {
    elStatus.textContent = text;
    elStatus.className = "tag " + (ok ? "ok" : "warn");
  }

  function getTextResult(teamA, teamB) {
    const meleeA = countRole(teamA, "近接");
    const meleeB = countRole(teamB, "近接");
    return [
      "【5対5 ジョブ抽選結果】",
      `チームA（近接${meleeA}/遠隔${5 - meleeA}）`,
      ...teamA.map(j => `- ${formatJob(j)}`),
      "",
      `チームB（近接${meleeB}/遠隔${5 - meleeB}）`,
      ...teamB.map(j => `- ${formatJob(j)}`),
    ].join("\n");
  }

  let last = null;

  function run() {
    const result = generateMatch(5000);
    if (!result) {
      setStatus("失敗：条件を満たす組み合わせが見つかりません", false);
      elLog.textContent = "試行回数上限に到達しました。maxTriesを増やすか、ルール緩和が必要です。";
      return;
    }
    last = result;

    renderTeam(elA, result.teamA);
    renderTeam(elB, result.teamB);

    elCountA.textContent = `（近接 ${result.meleeA} / 遠隔 ${5 - result.meleeA}）`;
    elCountB.textContent = `（近接 ${result.meleeB} / 遠隔 ${5 - result.meleeB}）`;

    setStatus("OK：条件クリア", true);
    elLog.textContent = `条件クリアまでの試行回数：${result.tries} 回（近接A=${result.meleeA}, 近接B=${result.meleeB}）`;
  }

  btn.addEventListener("click", run);

  btnCopy.addEventListener("click", async () => {
    if (!last) return;
    const text = getTextResult(last.teamA, last.teamB);
    try {
      await navigator.clipboard.writeText(text);
      elLog.textContent = "コピーしました！";
    } catch {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      elLog.textContent = "コピーしました！（フォールバック）";
    }
  });

  run();
</script>
</body>
</html>
