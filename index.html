<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FF14 5v5 ジョブ抽選</title>
  <style>
    :root{
      --bg0:#0b0f17;
      --bg1:#0f1626;
      --card:#111a2b;
      --card2:#0f172a;
      --border:rgba(255,255,255,.10);
      --text:#e8eefc;
      --muted:rgba(232,238,252,.72);
      --muted2:rgba(232,238,252,.55);

      --accent:#7aa2ff;
      --accent2:#a78bfa;
      --good:#35d07f;
      --warn:#ff5c7a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }

    /* 横幅をできるだけ使う（右の空白が出にくい） */
    body{
      margin: 10px;
      max-width: 1600px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 500px at 20% 0%, rgba(122,162,255,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(167,139,250,.16), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    /* ヘッダーバー */
    .header{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 14px 14px 12px;
      margin-bottom: 12px;
    }

    h1{
      font-size: 22px;
      margin: 0 0 10px;
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size:12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }

    .topbar{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    /* ボタン */
    button{
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      font-size: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
      transition: transform .05s ease, background .12s ease, border-color .12s ease;
    }
    button:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.16);
    }
    button:active{ transform: translateY(1px); }

    .hint{
      color: var(--muted2);
      font-size: 14px;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: rgba(232,238,252,.35);
    }
    .ok{ color: var(--good); border-color: rgba(53,208,127,.35); background: rgba(53,208,127,.08); }
    .ok .dot{ background: var(--good); }
    .warn{ color: var(--warn); border-color: rgba(255,92,122,.35); background: rgba(255,92,122,.08); }
    .warn .dot{ background: var(--warn); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .cardTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .cardTitle strong{
      font-size: 18px;
      letter-spacing:.2px;
    }
    .counts{
      color: var(--muted);
      font-size: 14px;
      white-space:nowrap;
    }

    ul{ margin: 0; padding-left: 0; list-style:none; }
    li{
      margin: 10px 0;   /* 行間 */
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
    }

    /* ジョブ表示（大きめ） */
    .jobRow{
      display:flex;
      align-items:center;
      gap:12px;
      font-size: 20px;   /* 文字 */
      line-height:1.2;
    }
    .jobIcon{
      width: 32px;       /* アイコン */
      height: 32px;
      object-fit: contain;
      flex: 0 0 32px;
      filter: drop-shadow(0 3px 10px rgba(0,0,0,.35));
    }
    .rolePill{
      margin-left: auto;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    .role-melee{ border-color: rgba(122,162,255,.35); color: rgba(180,205,255,.95); background: rgba(122,162,255,.10); }
    .role-range{ border-color: rgba(167,139,250,.35); color: rgba(216,200,255,.95); background: rgba(167,139,250,.10); }

    /* ログ */
    .logBox{
      margin-top: 12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.20);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
    }
    .logTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .logTitle strong{ font-size: 16px; }
    #log{ color: var(--muted); font-size: 14px; }

    code{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding: 2px 6px;
      border-radius: 8px;
      color: rgba(232,238,252,.9);
    }

    @media (max-width: 920px){
      body{ max-width:none; }
      .grid2{ grid-template-columns: 1fr; }
      li{ padding: 10px 10px; }
      .jobRow{ font-size: 18px; }
      .jobIcon{ width: 30px; height: 30px; flex-basis: 30px; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>
      5対5 ジョブランダム抽選
      <span class="badge">チーム内重複なし / 近接差±1以内</span>
    </h1>

    <div class="topbar">
      <button id="btn">ランダム抽選</button>
      <button id="btnCopy">結果をコピー</button>

      <span id="status" class="tag">
        <span class="dot"></span>
        <span>未抽選</span>
      </span>

      <span class="hint">ルール: チーム内重複NG / |近接A-近接B| ≤ 1</span>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="cardTitle">
        <strong>チームA</strong>
        <span id="countA" class="counts"></span>
      </div>
      <ul id="teamA"></ul>
    </div>

    <div class="card">
      <div class="cardTitle">
        <strong>チームB</strong>
        <span id="countB" class="counts"></span>
      </div>
      <ul id="teamB"></ul>
    </div>
  </div>

  <div class="logBox">
    <div class="logTitle">
      <strong>抽選ログ</strong>
      <span class="badge">最大 <code>5000</code> 回試行</span>
    </div>
    <div id="log">ここに試行回数などが出ます</div>
    <div class="hint" style="margin-top:8px;">
      ※条件が厳しい時は自動で引き直します。
    </div>
  </div>

<script>
  const JOBS = [
    // 近接
    { name: "ナイト", role: "近接" },
    { name: "戦士", role: "近接" },
    { name: "ガンブレイカー", role: "近接" },
    { name: "暗黒騎士", role: "近接" },
    { name: "竜騎士", role: "近接" },
    { name: "侍", role: "近接" },
    { name: "忍者", role: "近接" },
    { name: "リーパー", role: "近接" },
    { name: "ヴァイパー", role: "近接" },
    { name: "モンク", role: "近接" },

    // 遠隔
    { name: "踊り子", role: "遠隔" },
    { name: "吟遊詩人", role: "遠隔" },
    { name: "機工士", role: "遠隔" },
    { name: "召喚士", role: "遠隔" },
    { name: "赤魔道士", role: "遠隔" },
    { name: "黒魔道士", role: "遠隔" },
    { name: "ピクトマンサー", role: "遠隔" },
    { name: "白魔道士", role: "遠隔" },
    { name: "学者", role: "遠隔" },
    { name: "占星術師", role: "遠隔" },
    { name: "賢者", role: "遠隔" },
  ];

  const JOB_ICON = {
    "ナイト": "Paladin.png",
    "戦士": "Warrior.png",
    "ガンブレイカー": "Gunbreaker.png",
    "暗黒騎士": "DarkKnight.png",
    "竜騎士": "Dragoon.png",
    "侍": "Samurai.png",
    "忍者": "Ninja.png",
    "リーパー": "Reaper.png",
    "ヴァイパー": "Viper.png",
    "モンク": "Monk.png",
    "吟遊詩人": "Bard.png",
    "機工士": "Machinist.png",
    "踊り子": "Dancer.png",
    "黒魔道士": "BlackMage.png",
    "召喚士": "Summoner.png",
    "赤魔道士": "RedMage.png",
    "ピクトマンサー": "Pictomancer.png",
    "白魔道士": "WhiteMage.png",
    "学者": "Scholar.png",
    "占星術師": "Astrologian.png",
    "賢者": "Sage.png",
  };

  function getJobIconPath(jobName){
    const file = JOB_ICON[jobName];
    return file ? `アイコン/${file}` : null;


  function randInt(max) { return Math.floor(Math.random() * max); }

  function pickUniqueJobs(k) {
    const pool = JOBS.slice();
    const out = [];
    for (let i = 0; i < k; i++) {
      const idx = randInt(pool.length);
      out.push(pool[idx]);
      pool.splice(idx, 1);
    }
    return out;
  }

  function countRole(team, role) {
    return team.reduce((acc, j) => acc + (j.role === role ? 1 : 0), 0);
  }

  function formatJob(job) {
    return `${job.name}（${job.role}）`;
  }

  function generateMatch(maxTries = 5000) {
    for (let t = 1; t <= maxTries; t++) {
      const teamA = pickUniqueJobs(5);
      const teamB = pickUniqueJobs(5); // Aと被ってOK

      const meleeA = countRole(teamA, "近接");
      const meleeB = countRole(teamB, "近接");
      if (Math.abs(meleeA - meleeB) <= 1) {
        return { teamA, teamB, tries: t, meleeA, meleeB };
      }
    }
    return null;
  }

  const elA = document.getElementById("teamA");
  const elB = document.getElementById("teamB");
  const elCountA = document.getElementById("countA");
  const elCountB = document.getElementById("countB");
  const elStatus = document.getElementById("status");
  const elLog = document.getElementById("log");
  const btn = document.getElementById("btn");
  const btnCopy = document.getElementById("btnCopy");

  function renderTeam(el, team) {
    el.innerHTML = "";
    team.forEach(j => {
      const li = document.createElement("li");
      const icon = getJobIconPath(j.name);
      const roleClass = (j.role === "近接") ? "role-melee" : "role-range";
      li.innerHTML = `
        <div class="jobRow">
          ${icon ? `<img class="jobIcon" src="${icon}" alt="${j.name}">` : ""}
          <span>${j.name}</span>
          <span class="rolePill ${roleClass}">${j.role}</span>
        </div>
      `;
      el.appendChild(li);
    });
  }

  function setStatus(text, ok) {
    elStatus.querySelector("span:last-child").textContent = text;
    elStatus.className = "tag " + (ok ? "ok" : "warn");
    // dot色も変える
    const dot = elStatus.querySelector(".dot");
    dot.className = "dot";
    if (ok) dot.style.background = "var(--good)";
    else dot.style.background = "var(--warn)";
  }

  function getTextResult(teamA, teamB) {
    const meleeA = countRole(teamA, "近接");
    const meleeB = countRole(teamB, "近接");
    return [
      "【5対5 ジョブ抽選結果】",
      `チームA（近接${meleeA}/遠隔${5 - meleeA}）`,
      ...teamA.map(j => `- ${formatJob(j)}`),
      "",
      `チームB（近接${meleeB}/遠隔${5 - meleeB}）`,
      ...teamB.map(j => `- ${formatJob(j)}`),
    ].join("\n");
  }

  let last = null;

  function run() {
    const result = generateMatch(5000);
    if (!result) {
      setStatus("失敗：条件を満たす組み合わせが見つかりません", false);
      elLog.textContent = "試行回数上限に到達しました。maxTriesを増やすか、ルール緩和が必要です。";
      return;
    }
    last = result;

    renderTeam(elA, result.teamA);
    renderTeam(elB, result.teamB);

    elCountA.textContent = `近接 ${result.meleeA} / 遠隔 ${5 - result.meleeA}`;
    elCountB.textContent = `近接 ${result.meleeB} / 遠隔 ${5 - result.meleeB}`;

    setStatus("OK：条件クリア", true);
    elLog.textContent = `条件クリアまでの試行回数：${result.tries} 回（近接A=${result.meleeA}, 近接B=${result.meleeB}）`;
  }

  btn.addEventListener("click", run);

  btnCopy.addEventListener("click", async () => {
    if (!last) return;
    const text = getTextResult(last.teamA, last.teamB);
    try {
      await navigator.clipboard.writeText(text);
      elLog.textContent = "コピーしました！";
    } catch {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      elLog.textContent = "コピーしました！（フォールバック）";
    }
  });

  run();
</script>
</body>
</html>

